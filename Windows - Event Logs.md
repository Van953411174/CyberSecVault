# Windows - Event Logs
#Windows Event Logs are not text files but raw data that can be translated into #XML using the Windows API.  The events stored in these log files are stored in a proprietary binary format with a *.evt* or *.evtx* extension, the latter typically residing in `C:\Windows\System32\winevt\Logs`
## Enabling some Features
**Note**: Some events will not be generated by default, and certain features will need to be enabled/configured on the endpoint, such as **PowerShell logging** . 
### PowerShell Logging
This feature can be enabled via **Group Policy** or the **Registry**.

*Local Computer Policy -> Computer Configuration -> Administrative Templates -> Windows PowerShell*

Some resources to provide more information about enabling this feature, along with its associated event IDs:

-   [About Logging Windows](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_logging_windows?view=powershell-7.1)
-   [Greater Visibility Through PowerShell Logging](https://www.fireeye.com/blog/threat-research/2016/02/greater_visibilityt.html)
-   [Configure PowerShell logging to see PowerShell anomalies in Splunk UBA](https://docs.splunk.com/Documentation/UBA/5.0.4/GetDataIn/AddPowerShell)

### Audit Process Creation
Detailed docs on feature: https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/command-line-process-auditing#try-this-explore-command-line-process-auditing

Another feature to enable/configure is **Audit Process Creation**, which will generate **event ID 4688**. This will enable **command-line process auditing**. This setting is NOT enabled in the virtual machine but feel free to enable it and observe the events generated after executing some commands.

*Local Computer Policy -> Computer Configuration -> Administrative Templates -> System -> Audit Process Creation*


## Types of Events and Logs
### Events
There are [5 types](https://docs.microsoft.com/en-us/windows/win32/eventlog/event-types) of events that can be logged. Brief table follow with expanded descriptions in link. 

| Event Types   | Description                                           |
| ------------- | ----------------------------------------------------- |
| Error         | significant problem such as loss of data/functionality |
| Warning       | not significant but could cause future problems       |
| Information   | successful operation of app/driver/service            |
| Success Audit | successful security access                            |
| Failure Audit | failed security access                                                      |

#### Event IDs
There are **LOTS** of event IDs. As such knowing *what* IDs matter to you is half the battle to finding a needle in a haystack indicating a breach #blue_team, in fact [[ATT&CK Framework]] lists event IDs well. 



- [Spotting the Adversary w/ Windows Event Log Monitoring](https://apps.nsa.gov/iaarchive/library/reports/spotting-the-adversary-with-windows-event-log-monitoring.cfm)
-    [Windows Logging Cheat Sheet ver Oct 2016](https://static1.squarespace.com/static/552092d5e4b0661088167e5c/t/580595db9f745688bc7477f6/1476761074992/Windows+Logging+Cheat+Sheet_ver_Oct_2016.pdf)
-   [Events to Monitor](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor) (Best Practices for Securing Active Directory)
-   [The Windows 10 and Windows Server 2016 Security Auditing and Monitoring Reference](https://www.microsoft.com/en-us/download/confirmation.aspx?id=52630)Â (a comprehensive list \[**over 700 pages**\])



### Logs
There are [4 types](https://docs.microsoft.com/en-us/windows/win32/eventlog/eventlog-key) of Windows Logs. As above, brief table follows:

| Log Type     | Description                                                                                                                     |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| Application  | Events logged by applications                                                                                                   |
| Security     | Events such as valid/invalid login attempts, as well a events related to resource use (creating/opening/deleting files or objs) |
| System       | Events logged by system components, such as the failure of a driver or other system component                                   |
| *Custom Log* | Events logged by applications that create a custom logs                                                                                                                                |

For example, #PowerShell (an application), will log operations from the engine, providers, and cmdlets to the Windows event log. 

## Methods of Access
Three Main ways of accessing event logs within a Windows system:
1.  [[Windows - Event Logs#Event Viewer|Event Viewer]] (GUI-based application)
2.  [[Windows - Event Logs#wevtutil exe|Wevtutil.exe]] (command-line tool)
3.  [[Windows - Event Logs#Get-WinEvent|Get-WinEvent]] (PowerShell cmdlet)

Other utils:
- [[Windows - Event Logs#XPath Query]] (filtering)

### Event Viewer
![[Event Viewer]]
### wevtutil.exe
![[wevtutil.exe]]
### Get-WinEvent
![[Get-WinEvent]]
### XPath Query
![[XPath Query]]